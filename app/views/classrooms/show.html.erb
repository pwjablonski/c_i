<div class="page-header ribbon-top">
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
          <h1><%= @classroom.name%></h1>
     </div> 
    </div>
      <!-- /.col-lg-12 -->
  </div>
</div> 

 <div class="container">
    
          <% flash.each do |name, msg| -%>
              <div class="alert alert-success alert-dismissable">
                  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                  <%= msg %> 
              </div>
          <%end%>
            <!-- /.row -->
            <div class="row">
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <!-- Nav tabs -->
                            <ul class="nav nav-pills nav-justified">
                                <li class="active"><a href="#overview-student-pills" data-toggle="tab">Overview</a>
                                </li>
                                <li><a href="#list-student-pills" data-toggle="tab">Students</a>
                                </li>
                                <li><a href="#attendence-student-pills" data-toggle="tab">Attendance</a>
                                </li>
                                <li><a href="#awards-student-pills" data-toggle="tab">Awards</a>
                                </li>
                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div class="tab-pane fade in active" id="overview-student-pills">
                                  

                                <%= line_chart @classroom.students.map{|student|
                                 {name: student.first_name + student.last_name, data: student.ca_data.group_by_day(:created_at, time_zone: "Eastern Time (US & Canada)", range: student.ca_data.first.created_at..Time.now).maximum(:total_points)}
                                } %>

                                <%= column_chart @classroom.students.map{|student|
                                 {name: student.first_name + student.last_name, data: student.ca_data.group_by_day(:created_at, last: 1).maximum(:total_points)}
                                } %>

                                </div>

                               
                                <div class="tab-pane fade" id="list-student-pills">
                                    <h4>Add Students</h4>

                                    <%= form_tag classroom_enrollments_path(@classroom ) do %>
                                        <div class="form-group">
                                            <%= text_field_tag(:student_email, "Add students by email...", :class => "form-control") %>
                                         </div>   
                                            <%= hidden_field_tag(:classroom_id, @classroom.id) %>
                                            <%= submit_tag "Add Student", :class => "btn btn-default" %>
                                    <% end %>


                                    <% @classroom.enrollments.each do |enrollment| %>
                                      <div class="col-md-3">
                                        <a href="/students/<%= enrollment.student.id %>">
                                            <div class="well well-sm">
                                                <%= image_tag enrollment.student.user.image, :height => "50px" %>
                                                <%= enrollment.student.first_name %>
                                            </div>
                                        </a> 
                                      </div>
                                    <%end%>
                                    
                                    <!-- /.table-responsive -->
                                
                                </div>
                                <div class="tab-pane fade" id="attendence-student-pills">
                                    
                                    <h4>Attendence</h4>
                                    
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-hover table-striped">
                                            <thead>
                                          <tr>
                                            <th>C/I ID</th>
                                            <th>Name</th>
                                            <th>Profile Name</th>
                                            <th>Email</th>
                                            <th>Remove Student?</th> 
                                          </tr>
                                        </thead>
                                        <tbody>              
                                          <% @classroom.enrollments.each do |enrollment| %>
                                          <tr>
                                            <td><%= enrollment.student.id %></td>
                                            <td><a href="/students/<%= enrollment.student.id %>"><%= enrollment.student.first_name %></a></td>
                                            <td><%= enrollment.student.profile_name %></td>
                                            <td><%= enrollment.student.user.email %></td>
                                            <% if current_user == @classroom.teacher.user || current_user == enrollment.student.user%> 
                                            <td><%= link_to 'Remove', [@classroom, enrollment], method: :delete, data: { confirm: 'Are you sure?' } %></td> 
                                            <%end%>
                                          </tr>
                                          <%end%>
                                        </tbody>
                                        </table>
                                    </div>
                                   
                                </div>
                                <div class="tab-pane fade" id="awards-student-pills">
                                    
                                    <h4>Awards</h4>
                                    
                                    <!-- /.table-responsive -->
                                
                                </div>
                            </div>
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                    <!-- /.panel -->
 </div>  

